<!--
  Esquire frameworks (tm)
 
  Copyright(c) 2001, 2025 mir0n&co www.mir0n.me
  mailto:mir0n.the.programmer@gmail.com

  History:
-->
<div class="esq-explorer-container">
<mat-toolbar class="mat-elevation-z2 esq-toolbar"> 

  <button matIconButton
    class = "esq-icon-button"
    matTooltip = "{{EsqSidenav.opened ? 'Hide tree navigation' : 'Open tree navigation'}}" 
    (click)="EsqSidenav.toggle()">
    <mat-icon>
        {{EsqSidenav.opened ? 'folder_open': 'folder_off'}}"    
    </mat-icon>
  </button>

  <button #esqBtnBack matIconButton 
    class = "esq-icon-button"
    matTooltip="Back"
    disabled = "{{!canBtnBackClick()}}"
    (click)="onBtnBackClick()">
    <mat-icon>arrow_back</mat-icon>
  </button>

  <button #esqBtnForward matIconButton 
    class = "esq-icon-button"
    matTooltip="Forward"
    disabled = "{{!canBtnForwardClick()}}"
   (click)="onBtnForwardClick()">
    <mat-icon>arrow_forward</mat-icon>
  </button>

  <button #esqBtnUp matIconButton 
    class = "esq-icon-button"
    matTooltip="Up one level "
    disabled = "{{!canBtnUpClick()}}"
    (click)="onBtnUpClick()">
    
    <mat-icon>arrow_upward</mat-icon>
  </button>

  @if (initialDataLoading()) {
    <span class="esq-loading-div" ></span>
  } @else {
    <button matIconButton 
      class = "esq-icon-button"
      matTooltip="Refresh"
      (click)="onBtnRefreshClick()">
      <mat-icon>refresh</mat-icon>
    </button>
  }

  <div class="esq-path-bar">
    {{listNodeOwnerPath()}}
  </div>

  <button #matBtnDetails matIconButton
    class = "esq-icon-button"
    matTooltip="Details"  
    disabled = "false"  
    (click)="onBtnDetailsClick()">
    <mat-icon>wysiwyg</mat-icon>
  </button>

  <button #esqBtnGoto matIconButton 
    class = "esq-icon-button"
    matTooltip="Go to origin"  
    disabled = "{{!canBtnGotoClick()}}"
    (click)="onBtnGotoClick()">
    <mat-icon>launch</mat-icon>
  </button>

  @if (dataLoading()) {
    <span class="esq-loading-div" style="width:24px" ></span>
  } @else {
    <button #esqBtnMore matIconButton 
      class = "esq-icon-button"
      matTooltip="Load more..."  
      disabled = "{{!canBtnMoreClick()}}"
      (click)="onBtnMoreClick()">
      <mat-icon>rotate_right</mat-icon>
    </button>
  }

</mat-toolbar>
<mat-sidenav-container class="esq-sidenav-container" esqResize>
    <mat-sidenav 
      #EsqSidenav
      style="width: 250px"
      role="navigation"
      mode="side" 
      opened 
      class="esq-sidenav"
      [fixedInViewport]= "false" 
      [fixedTopGap]= "0" 
      [fixedBottomGap]= "0"
    >
      @if (initialDataLoading()) {
        <div>
          <span style="position:relative; left:18px;">...Loading initial data...</span>
        </div>      
      }
      <mat-tree #EsqExplTree
        [dataSource]="datasource.tree"
        [levelAccessor]="treeLevelAccessor">
        <mat-tree-node
          *matTreeNodeDef="let _node let i = index"
          #nodeElement [attr.id]="'node-' + _node.id"
          matTreeNodePadding
          matTreeNodePaddingIndent="30"
          class="esq-tree-node"
          (expandedChange)="onTreeNodeExpansion($event,_node)" 
          (click)="onTreeClick(_node)" 
          (dblclick)="onTreeDoubleClick(_node)"
          (mouseenter)="onTreeNodeEnter(_node)" 
          (mouseleave)="onTreeNodeLeave()"
          (focus)="onTreeFocus(_node)"
          (focusout)="onTreeFocusOut(_node)"
          (keydown)="onTreeKeydown($event, node)"
          [ngClass]="{ 'esq-active-node-highlight': treeNodeActive === _node && treeOnFocus,  'esq-active-node-outlight': treeNodeActive === _node && !treeOnFocus, 'esq-mouse-node-highlight': treeNodeEntered === _node}"
        >
          @let node = _node | asEsqTreeNode;
          <div style="display: flex; flex-direction: row; align-items: left; justify-items: left">
            <div 
              style="z-index:0; user-select: none; display: flex; flex-direction: row; align-items: center;" 
            > 
              <mat-icon class="mat-icon-rtl-mirror">
                @if (node.hasChild()) {
                      {{ node.expanded() ? 'expand_more' : 'chevron_right' }}
                }
              </mat-icon>
              @if (hasIcon(node)) {
                <img src="{{nodeIcon(node)}}" class="esq-base-icon"/>
                <img src="{{nodeStatusIcon(node)}}" class="esq-overlay-icon" />
              }
              @if (node.hasMore()) {
                  <div class="esq-overlay-text"> {{ node.name }} ...</div>
              } @else {
                  <div class="esq-overlay-text"> {{ node.name }}  </div>
              }
              </div> 
          </div>
        </mat-tree-node>
      </mat-tree>
    </mat-sidenav>

    <mat-sidenav-content>
      <table mat-table
        #EsqExplList 
        [dataSource]="datasource.list" 
        class="mat-table esq-table"
      >
        @for (column of listColumns; track column.columnDef; let i = $index) {
          <ng-container [matColumnDef]="column.columnDef" >
            <th mat-header-cell *matHeaderCellDef  esqResize class="mat-elevation-z2 esq-elevation-z2">
              {{column.header}}
            </th>
            <td mat-cell *matCellDef="let node" class="mat-cell esq-ellipsis-cell">
              @if (column.columnDef === 'name') {
                <!--span class="esq-ellipsis-text" -->
                <span class="esq-ellipsis-text">
                  <img src="{{nodeIcon(node)}}" class="esq-base-icon "/>
                  <img src="{{nodeStatusIcon(node)}}" class="esq-overlay-icon" />
                  {{node.value(column.columnDef) }}
                </span>
                <!-- /span -->
              } @else {
                <span class="esq-ellipsis-text">
                  {{node.value(column.columnDef) }}
                </span>
              }
            </td>
          </ng-container>
        }
        <tr mat-header-row 
          *matHeaderRowDef="listColumnsDisplayed; sticky: true" 
          class="mat-header-row esq-header-row">
        </tr>
        <tr mat-row
            *matRowDef="let node; let i = index; columns: listColumnsDisplayed;" 
            class="mat-row esq-row"
            (mouseover)="listNodeHoveredIndex = i"
            (mouseout)="listNodeHoveredIndex = -1"
            [ngClass]="{'esq-active-node-highlight': node === listNodeFocused && !treeOnFocus,  'esq-active-node-outlight': node === listNodeFocused && treeOnFocus, 'esq-mouse-node-highlight': listNodeHoveredIndex === i}"
            (click)="onListClick(node)"
            (dblclick)="onListDoubleClick(node)"
            (keydown)="onListKeydown($event, node, i)"
            (focus)="onListFocus(node)"
            (focusout)="onListFocusOut(node)"
            [tabindex]="node === listNodeFocused ? 0 : -1"
        >
        </tr>  
      </table>
    </mat-sidenav-content>
  </mat-sidenav-container>
</div>  



